# Hook

Hook æ˜¯ä¸€äº›å¯ä»¥è®©ä½ åœ¨å‡½æ•°ç»„ä»¶é‡Œ"é’©å…¥"React state åŠç”Ÿå‘½å‘¨æœŸç­‰ç‰¹æ€§çš„å‡½æ•°ã€‚React å†…ç½®äº†ä¸€äº›åƒ`useState`è¿™æ ·çš„ Hookã€‚ä½ ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„ Hook æ¥å¤ç”¨ä¸åŒç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘ã€‚
**Hook è§„åˆ™**
1. **åªå¯ä»¥åœ¨æœ€é¡¶å±‚ä½¿ç”¨**ï¼ˆå³ä¸è¦å†å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­ä½¿ç”¨ï¼‰ï¼Œä¸ç„¶ä»–ä»¬çš„è°ƒç”¨é¡ºåºä¼šå‡ºç°é—®é¢˜ã€‚å¦‚æœæƒ³ä½¿ç”¨å¾ªç¯æˆ–åˆ¤æ–­çš„è¯ï¼Œå¯ä»¥åœ¨Hooké‡Œé¢ä½¿ç”¨ã€‚ åªå¯ä»¥åœ¨æœ€é¡¶å±‚ä½¿ç”¨
2. **åªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨ Hook**ï¼Œåªèƒ½åœ¨reactå‡½æ•°ç»„ä»¶åŠè‡ªå®šä¹‰Hookä¸­ä½¿ç”¨ã€‚ä¸èƒ½åœ¨javascriptå‡½æ•°ä¸­ä½¿ç”¨ã€‚

**åŸå› ï¼š** æ„Ÿè§‰è·Ÿå‡½æ•°çš„å‚æ•°æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å†™çš„hookå°±ç›¸å½“äºä¸€ä¸ªä¸ªä¼ å…¥å‡½æ•°ä¸­çš„å‚æ•°ï¼Œreactåœ¨åˆå§‹æ—¶ä¼šä¸€ä¸€å»ºç«‹å¯¹åº”ã€‚ä½†æ˜¯å½“ä½ åœ¨å¾ªç¯æˆ–åˆ¤æ–­ä¸­å†™ä¸Šæ—¶ï¼Œå½“æŸæ¬¡è¿è¡Œè·³è¿‡æˆ–å¤šå‡ºæŸä¸ªhookæ—¶ï¼Œreactè¿˜æ˜¯æŒ‰åŸæ¥çš„ä¸ªæ•°å¯¹åº”ç€èµ°ï¼Œç„¶åå°±ä¼šå‡ºç°æ··ä¹±ã€‚
```js
 useEffect(function persistForm() {
    // ğŸ‘ å°†æ¡ä»¶åˆ¤æ–­æ”¾ç½®åœ¨ effect ä¸­
    if (name !== '') {
      localStorage.setItem('formData', name);
    }
  });
```

## State Hook

`useState` è¿”å›ä¸€ä¸ª `state`ï¼Œä»¥åŠæ›´æ–° state çš„å‡½æ•°`setState`ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»“æ„èµ‹å€¼çš„æ–¹å¼æ¥æ”¶ï¼Œåå­—éå›ºå®šï¼Œå¯ä»¥éšæ„å¡«å†™ã€‚`initialState`æ˜¯æŒ‡é»˜è®¤çš„`state`çš„å€¼ï¼Œéå¿…å¡«ï¼Œåªä¼šåœ¨ç»„ä»¶çš„åˆå§‹æ¸²æŸ“ä¸­èµ·ä½œç”¨ï¼Œåç»­æ¸²æŸ“æ—¶ä¼šè¢«å¿½ç•¥ï¼Œä¹Ÿ`å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°`ï¼Œåœ¨å‡½æ•°ä¸­è®¡ç®—å¹¶è¿”å›åˆå§‹çš„ stateã€‚

```js
const [state, setState] = useState(initialState)
```

`setState`æ›´æ”¹ state æ—¶ï¼Œé¡µé¢ä¼šé‡æ–°æ¸²æŸ“ã€‚åœ¨`setState`ä¸­å¯ä»¥å†™ä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°å°±æ˜¯ä¸Šæ¬¡çš„`state`å€¼,å¯ä»¥ç”¨å¯¹è±¡åˆå¹¶çš„æ–¹å¼æ›´æ”¹æœ¬æ¬¡è¦ä¿®æ”¹çš„å€¼ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½æŠŠæ‰€æœ‰å€¼å†™ä¸€éã€‚ï¼ˆå› ä¸º`useState`ä¸ä¼šè‡ªåŠ¨åˆå¹¶æ›´æ–°å¯¹è±¡ï¼Œå¦‚æœä½ åœ¨è®¾ç½®é‡Œä¸å†™çš„è¯ï¼Œå°±ä¼šæ²¡æœ‰äº†ã€‚è¿™ç‚¹è·Ÿä»¥å‰çš„ setState ä¸ä¸€æ ·ï¼‰

```js
setState((prevState) => {
  // ä¹Ÿå¯ä»¥ä½¿ç”¨ Object.assign
  return { ...prevState, ...updatedValues }
})
```

## Effect Hook

**å‰¯ä½œç”¨ï¼š** æˆ‘ä»¬æŠŠåœ¨ç»„ä»¶ä¸­æ‰§è¡Œçš„æ•°æ®è·å–ã€è®¢é˜…å’Œæ‰‹åŠ¨ä¿®æ”¹ Dom ç­‰æ“ä½œç»Ÿä¸€ç§°ä¹‹ä¸ºâ€œå‰¯ä½œç”¨â€ã€‚
`useEffect`ç”¨æ¥æ›¿ä»£ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ã€‚

1. å½“ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ä¼šè°ƒç”¨`useEffect`ã€‚
2. å¦‚æœå…¶æœ‰è¿”å›å‡½æ•°çš„è¯ï¼Œå°±ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œè¯¥è¿”å›å‡½æ•°,æ¸…é™¤`effect`ã€‚å¦‚æœç»„ä»¶å¤šæ¬¡æ¸²æŸ“ï¼ˆé€šå¸¸å¦‚æ­¤ï¼‰ï¼Œåˆ™åœ¨æ‰§è¡Œä¸‹ä¸€ä¸ª `effect` ä¹‹å‰ï¼Œä¸Šä¸€ä¸ª `effect` å°±å·²è¢«æ¸…é™¤ã€‚
3. ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥è§„å®šåœ¨å“ªä¸ªå‚æ•°å˜åŒ–æ—¶æ‰è°ƒç”¨è¯¥`Effect`

```js
useEffect(() => {
  function handleStatusChange(status) {
    setIsOnline(status.isOnline)
  }

  ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange)
  return () => {
    ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange)
  }
}, [props.friend.id]) // ä»…åœ¨ props.friend.id å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡æ–°è®¢é˜…
```

> å¦‚æœæƒ³æ‰§è¡Œåªè¿è¡Œä¸€æ¬¡çš„ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚

## Context Hook
`useContext` æ¥æ”¶ä¸€ä¸ª**context å¯¹è±¡**(React.createContext çš„è¿”å›å€¼)å¹¶è¿”å›è¯¥ context çš„å½“å‰å€¼ã€‚å½“å‰çš„ context å€¼ç”±ä¸Šå±‚ç»„ä»¶ä¸­è·ç¦»å½“å‰ç»„ä»¶æœ€è¿‘çš„ `<MyContext.Provider>` çš„ value prop å†³å®šã€‚
**æ³¨ï¼š**å¿…é¡»æ˜¯contesxtå¯¹è±¡ï¼Œä¸èƒ½ä¼ å…¥`MyContext.Consumer`ä¹‹ç±»çš„contextçš„å±æ€§ã€‚

```js
const value = useContext(MyContext);
```

> useContext(MyContext) ç›¸å½“äº class ç»„ä»¶ä¸­çš„ `static contextType = MyContext` æˆ–è€… `<MyContext.Consumer>`ã€‚

è°ƒç”¨äº† useContext çš„ç»„ä»¶æ€»ä¼šåœ¨ context å€¼å˜åŒ–æ—¶**é‡æ–°æ¸²æŸ“**ã€‚å¦‚æœé‡æ¸²æŸ“ç»„ä»¶çš„å¼€é”€è¾ƒå¤§ï¼Œä½ å¯ä»¥ é€šè¿‡ä½¿ç”¨ memoization æ¥ä¼˜åŒ–ã€‚


## è‡ªå®šä¹‰Hook
è‡ªå®šä¹‰Hookæ˜¯ä¸ºäº†æŠŠä¸€äº›éœ€è¦ä½¿ç”¨ä½¿ç”¨åˆ°Hookçš„å‡½æ•°å°è£…ä¸ºå¯å¤ç”¨çš„ç»„ä»¶æ—¶ä½¿ç”¨çš„ã€‚ï¼ˆå› ä¸ºHookè§„åˆ™ä¸å…è®¸Hookå‡ºç°åœ¨åˆ«çš„ç»„ä»¶ä¸­ï¼Œä¼šå¯¼è‡´è¿è¡Œé”™è¯¯ï¼‰

è‡ªå®šä¹‰Hookå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä½†å®ƒæ¯”è¾ƒç‰¹åˆ«çš„æ˜¯å¿…é¡»ä½¿ç”¨**use**å¼€å¤´ï¼Œè¿™æ ·Reactå†…éƒ¨å°±ä¼šè‡ªåŠ¨è¯†åˆ«å®ƒä¸ºHookï¼Œå°†å…¶ç½®ä¸ºé¡¶å±‚å‡½æ•°ï¼Œæå‰æ‰§è¡Œã€‚å™¢ï¼Œè¿˜æœ‰è¿™ä¸ªå‡½æ•°å°±å¯ä»¥åœ¨å†…éƒ¨è°ƒç”¨å…¶ä»–Hookäº†ã€‚

## å…¶ä»–Hook

### 1. useRef

```js
const refContainer = useRef(initialValue);
```
`useRef` è¿”å›ä¸€ä¸ªå¯å˜çš„ `ref` å¯¹è±¡ï¼Œå…¶ `.current` å±æ€§è¢«åˆå§‹åŒ–ä¸ºä¼ å…¥çš„å‚æ•°`ï¼ˆinitialValueï¼‰`ã€‚è¿”å›çš„ ref å¯¹è±¡åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…`ä¿æŒä¸å˜`ã€‚

`useRef()` åˆ›å»ºçš„æ˜¯ä¸€ä¸ª**æ™®é€š Javascript å¯¹è±¡**, `useRef()` å’Œè‡ªå»ºä¸€ä¸ª `{current: ...}` å¯¹è±¡çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œ`useRef` ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ª `ref` å¯¹è±¡ã€‚

### 2. useImperativeHandle

```js
useImperativeHandle(ref, createHandle, [deps])
```
`useImperativeHandle` å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ `ref` æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”å½“é¿å…ä½¿ç”¨ ref è¿™æ ·çš„å‘½ä»¤å¼ä»£ç ã€‚`useImperativeHandle` åº”å½“ä¸ `forwardRef` ä¸€èµ·ä½¿ç”¨ï¼š

```js
function FancyInput(props, ref) {
  const inputRef = useRef();
  useImperativeHandle(ref, () => ({
    focus: () => {
      inputRef.current.focus();
    }
  }));
  return <input ref={inputRef} ... />;
}
FancyInput = forwardRef(FancyInput);

// çˆ¶ç»„ä»¶
function Father(){
  // â€¦â€¦
  const fInput = useRef()
  // ....
  fInput.current.focus()
  //â€¦â€¦
  <FancyInput ref={fInput} />
}
```
åœ¨æœ¬ä¾‹ä¸­ï¼Œæ¸²æŸ“ `<FancyInput ref={inputRef} />` çš„çˆ¶ç»„ä»¶`finput`å¯ä»¥è°ƒç”¨ `inputRef.current.focus()`ã€‚

è¿˜æœ‰ï¼šuseMemoã€useCallbackã€useReducerã€useLayoutEffectã€useDebugValueã€‚ç›®å‰æ²¡ç”¨åˆ°ï¼Œç”¨åˆ°åå†è¡¥å……ã€‚
